const TAGS={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function outdent(e){return e.replace(RegExp("^"+(e.match(/^(\t| )+/)||"")[0],"gm"),"")}function encodeAttr(e){return(e+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function parse(e,n){let t=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,r=[],o="",c=n||{},a=0,s,l,g,p,u;function d(e){var n=TAGS[e[1]||""],t=r[r.length-1]==e;return n?n[1]?(t?r.pop():r.push(e),n[0|t]):n[0]:e}function $(){let e="";for(;r.length;)e+=d(r[r.length-1]);return e}for(e=e.replace(/^\[(.+?)\]:\s*(.+)$/gm,(e,n,t)=>(c[n.toLowerCase()]=t,"")).replace(/^\n+|\n+$/g,"");g=t.exec(e);)l=e.substring(a,g.index),a=t.lastIndex,s=g[0],l.match(/[^\\](\\\\)*\\$/)||((u=g[3]||g[4])?s='<pre class="code '+(g[4]?"poetry":g[2].toLowerCase())+'"><code'+(g[2]?` class="language-${g[2].toLowerCase()}"`:"")+">"+outdent(encodeAttr(u).replace(/^\n+|\n+$/g,""))+"</code></pre>":(u=g[6])?(u.match(/\./)&&(g[5]=g[5].replace(/^\d+/gm,"")),p=parse(outdent(g[5].replace(/^\s*[>*+.-]/gm,""))),">"==u?u="blockquote":(u=u.match(/\./)?"ol":"ul",p=p.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),s="<"+u+">"+p+"</"+u+">"):g[8]?s=`<img src="${encodeAttr(g[8])}" alt="${encodeAttr(g[7])}">`:g[10]?(o=o.replace("<a>",`<a href="${encodeAttr(g[11]||c[l.toLowerCase()])}">`),s=$()+"</a>"):g[9]?s="<a>":g[12]||g[14]?(u="h"+(g[14]?g[14].length:"="<g[13]?1:2),s="<"+u+">"+parse(g[12]||g[15],c)+"</"+u+">"):g[16]?s="<code>"+encodeAttr(g[16])+"</code>":(g[17]||g[1])&&(s=d(g[17]||"--"))),o=(o+=l)+s;return(o+e.substring(a)+$()).replace(/^\n+|\n+$/g,"")}